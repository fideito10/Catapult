import streamlit as st
import time
import hashlib

def get_login_status():
    return st.session_state.get('logged_in', False)

def set_login_status(status):
    st.session_state['logged_in'] = status

def generate_token():
    return hashlib.sha256(str(time.time()).encode()).hexdigest()

def check_password():
    """Verifica la contrase帽a y maneja el estado de la sesi贸n."""
    if get_login_status():
        return True

    password = st.text_input("Contrase帽a", type="password")
    if st.button("Iniciar Sesi贸n"):
        if password == "universitario":
            token = generate_token()
            set_login_status(True)
            st.query_params.from_dict({"session_token": token})
            st.rerun()
        else:
            st.error(" Contrase帽a incorrecta")
    
    return False

def logout():
    """Cierra la sesi贸n del usuario."""
    set_login_status(False)
    st.query_params.clear()  # Limpia todos los par谩metros de la URL
    st.rerun()

# Aplicaci贸n principal
def main():
    st.title("Aplicaci贸n de An谩lisis Deportivo")

    # Verificar el token de sesi贸n en la URL
    params = st.query_params.to_dict()
    if 'session_token' in params and not get_login_status():
        set_login_status(True)

    if check_password():
        st.write("Bienvenido al an谩lisis deportivo!")
        
        # Aqu铆 va el contenido principal de tu aplicaci贸n
        st.write("Contenido protegido de la aplicaci贸n...")

        # Bot贸n de cierre de sesi贸n
        if st.button("Cerrar Sesi贸n"):
            logout()
    else:
        st.write("Por favor, inicia sesi贸n para acceder al contenido.")

if __name__ == "__main__":
    main()
